From 1cbd9b1aef1760e841eeab456102c282ec50cb08 Mon Sep 17 00:00:00 2001
From: Vladimir Barinov <vladimir.barinov@cogentembedded.com>
Date: Mon, 4 Oct 2021 20:10:44 +0300
Subject: [PATCH] media: i2c: ar0233: latest silicon should not load some stuff

The newest revision silicon should not load some stuff

Signed-off-by: Vladimir Barinov <vladimir.barinov@cogentembedded.com>
---
 drivers/media/i2c/soc_camera/ar0233.c      | 16 ++++++++++++++++
 drivers/media/i2c/soc_camera/ar0233_rev2.h |  4 ++++
 2 files changed, 20 insertions(+)

diff --git a/drivers/media/i2c/soc_camera/ar0233.c b/drivers/media/i2c/soc_camera/ar0233.c
index ae004ad..c6ede00 100644
--- a/drivers/media/i2c/soc_camera/ar0233.c
+++ b/drivers/media/i2c/soc_camera/ar0233.c
@@ -634,6 +634,14 @@ static int ar0233_initialize(struct i2c_client *client)
 					}
 					ar0233_set_regs(client, ar0233_regs_hdr_mipi_12bit_30fps_rev2);
 				} else if (strcmp(mode, "seplus") == 0) {
+					// If R0x300E version is earlier than 0x202D, then it should be load
+					reg16_read16(client, 0x300e, &val);
+					if (val >= 0x202d) {
+						ar0233_regs_seplus_mipi_12bit_60fps_rev2[4] = ar0233_rev2_empty;
+						ar0233_regs_seplus_mipi_12bit_60fps_rev2[8] = ar0233_rev2_empty;
+						ar0233_regs_seplus_mipi_12bit_60fps_rev2[9] = ar0233_rev2_empty;
+					}
+
 					ar0233_regs_seplus_mipi_12bit_60fps_rev2[10] = ar0233_rev2_SE_Lin_T2_12bit_30fps;
 					ar0233_set_regs(client, ar0233_regs_seplus_mipi_12bit_60fps_rev2);
 					if (extclk != 27) {
@@ -646,6 +654,14 @@ static int ar0233_initialize(struct i2c_client *client)
 					AR_DEFAULT_WIDTH = 1920;
 					AR_DEFAULT_HEIGHT = 1080;
 
+					// If R0x300E version is earlier than 0x202D, then it should be load
+					reg16_read16(client, 0x300e, &val);
+					if (val >= 0x202d) {
+						ar0233_regs_seplus_mipi_12bit_60fps_rev2[4] = ar0233_rev2_empty;
+						ar0233_regs_seplus_mipi_12bit_60fps_rev2[8] = ar0233_rev2_empty;
+						ar0233_regs_seplus_mipi_12bit_60fps_rev2[9] = ar0233_rev2_empty;
+					}
+
 					ar0233_set_regs(client, ar0233_regs_seplus_mipi_12bit_60fps_rev2);
 					if (extclk != 27) {
 						reg16_read16(client, 0x3030, &val);
diff --git a/drivers/media/i2c/soc_camera/ar0233_rev2.h b/drivers/media/i2c/soc_camera/ar0233_rev2.h
index d683213..e914d2b 100644
--- a/drivers/media/i2c/soc_camera/ar0233_rev2.h
+++ b/drivers/media/i2c/soc_camera/ar0233_rev2.h
@@ -3652,6 +3652,10 @@ static const struct ar0xxx_reg ar0233_rev2_SE_AGain_1x[] = {
 { }
 }; /* */
 
+static const struct ar0xxx_reg ar0233_rev2_empty[] = {
+{ }
+}; /* */
+
 /* 3Exp HDR, 1280P, MIPI 4-lane 12-bit, 30fps, EXTCLK=23MHz (comes from deser) */
 static const struct ar0xxx_reg *ar0233_regs_hdr_mipi_12bit_30fps_rev2[] = {
 	ar0233_rev2_Reset,
-- 
2.7.4

